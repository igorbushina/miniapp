const countries = {
  "–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω": [
    "–ê–≥–¥–∞–º", "–ê–≥–¥–∞—à", "–ê–≥–¥–∂–∞–±–µ–¥–∏", "–ê–≥—Å—Ç–∞—Ñ–∞", "–ê—Å—Ç–∞—Ä–∞",
    "–ë–∞–∫—É", "–ë–∞—Ä–¥–∞", "–ë–µ–π–ª–∞–≥–∞–Ω", "–ë–∞–ª–∞–∫–µ–Ω", "–ì—è–Ω–¥–∂–∞",
    "–ì–æ–±—É—Å—Ç–∞–Ω", "–ì—É–±–∞", "–ì–æ—Ä–∞–¥–∞–≥", "–ì—ë–π—á–∞–π", "–ì—è–Ω–¥–∂–∞",
    "–ó–∞–∫–∞—Ç–∞–ª—ã", "–ó–∞–≥–∞—Ç–∞–ª–∞", "–ó–∞—Ä–¥–æ–±", "–ò–º–∏—Ä–ª–∏", "–ò–º–∏—à–ª–∏",
    "–ö–µ–ª—å–±–∞–¥–∂–∞—Ä", "–ö—É—Å–∞—Ä—ã", "–ö—é—Ä–¥–∞–º–∏—Ä", "–õ–µ–Ω–∫–æ—Ä–∞–Ω—å", "–ú–∏–Ω–≥–µ—á–∞—É—Ä",
    "–ù–∞—Ñ—Ç–∞–ª–∞–Ω", "–ù–∞—Ö–∏—á–µ–≤–∞–Ω—å", "–ù–µ—Ñ—Ç–µ—á–∞–ª–∞", "–û–≥—É–∑", "–°–∞–∞—Ç–ª—ã",
    "–°–∞–±–∏—Ä–∞–±–∞–¥", "–°–∞–ª—å—è–Ω", "–°–∞–º—É—Ö", "–°—É–º–≥–∞–∏—Ç", "–¢–µ—Ä—Ç–µ—Ä",
    "–¢–æ–≤—É–∑", "–£–¥–∂–∞—Ä—ã", "–§–∏–∑—É–ª–∏", "–•–∞—á–º–∞–∑", "–•–æ–¥–∂–∞–≤–µ–Ω–¥",
    "–•—É–¥–∞—Ç", "–•—ã–∑—ã", "–®–∞–º–∫–∏—Ä", "–®–∞—Ä—É—Ä", "–®–µ–∫–∏",
    "–®–µ–º–∞—Ö–∞", "–®–∏—Ä–≤–∞–Ω", "–®—É—à–∞", "–Ø—Ä–¥—ã–º–ª—ã", "–ò—Å–º–∞–∏–ª–ª—ã"
  ],
  "–ê—Ä–º–µ–Ω–∏—è": [
    "–ê–±–æ–≤—è–Ω", "–ê–π—Ä—É–º", "–ê–ª–∞–≥—ë–∑", "–ê–ª–∞–≤–µ—Ä–¥–∏", "–ê–Ω–∏",
    "–ê—Ä–∞–≥–∞—Ü", "–ê—Ä–∞—Ä–∞—Ç", "–ê—Ä—Ç–∏–∫", "–ê—Ä–º–∞–≤–∏—Ä", "–ê—Ä—Ç–∞–≤–∞–∑",
    "–ê—Ä—Ü–Ω–∏", "–ê—à—Ç–∞—Ä–∞–∫", "–ë—é—Ä–µ–≥–∞–≤–∞–Ω", "–ë–µ—Ä–¥", "–í–∞–≥–∞—Ä—à–∞–ø–∞—Ç",
    "–í–∞–Ω–∞–¥–∑–æ—Ä", "–í–µ–¥–∏", "–ì–∞–≤–∞—Ä", "–ì–∞—Ä–Ω–∏", "–ì–µ—Ö–æ–≤–∏—Ç",
    "–ì–µ—Ö–∞—Ä–∫—É–Ω–∏–∫", "–ì–æ—Ä–∏—Å", "–ì—é–º—Ä–∏", "–î–∂–µ—Ä–º—É–∫", "–î–∏–ª–∏–∂–∞–Ω",
    "–ï–≥–≤–∞—Ä–¥", "–ï—Ä–∞—Å—Ö", "–ï—Ä–µ–≤–∞–Ω", "–ï—Ö–µ–≥–Ω–∞–¥–∑–æ—Ä", "–ó–æ–≤—É–Ω",
    "–ò–¥–∂–µ–≤–∞–Ω", "–ö–∞–ø–∞–Ω", "–ú–∞—Ä–∞–ª–∏–∫", "–ú–∞—Å–∏—Å", "–ú–∞—Ä—Ç—É–Ω–∏",
    "–ú–µ—Ü–∞–º–æ—Ä", "–ù–æ–µ–º–±–µ—Ä—è–Ω", "–ù–æ—Ä –ê—á–∏–Ω", "–ù–æ—Ä –•–∞—á–Ω", "–†–∞–∑–¥–∞–Ω",
    "–°–µ–≤–∞–Ω", "–°–∏—Å–∏–∞–Ω", "–°–ø–∏—Ç–∞–∫", "–°—Ç–µ–ø–∞–Ω–∞–≤–∞–Ω", "–¢–∞–ª–∏–Ω",
    "–¢–∞—à–∏—Ä", "–ß–∞—Ä–µ–Ω—Ü–∞–≤–∞–Ω", "–¶–∞—Ö–∫–∞–¥–∑–æ—Ä", "–®–Ω–æ—Ö", "–®–∏—Ä–∞–∫"
  ],
  "–ì–µ—Ä–º–∞–Ω–∏—è": [
    "–ê—É–≥—Å–±—É—Ä–≥", "–ë–µ—Ä–ª–∏–Ω", "–ë–∏–ª–µ—Ñ–µ–ª—å–¥", "–ë–æ–Ω–Ω", "–ë–æ—Ö—É–º",
    "–ë—Ä–∞—É–Ω—à–≤–µ–π–≥", "–ë—Ä–µ–º–µ–Ω", "–í–∏—Å–±–∞–¥–µ–Ω", "–í–æ–ª—å—Ñ—Å–±—É—Ä–≥", "–í—É–ø–ø–µ—Ä—Ç–∞–ª—å",
    "–ì–∞–Ω–Ω–æ–≤–µ—Ä", "–ì–µ–ª—å–∑–µ–Ω–∫–∏—Ä—Ö–µ–Ω", "–ì–µ–ª—å–¥–µ—Ä–Ω", "–ì–µ—Ä–∞", "–ì—ë—Ç—Ç–∏–Ω–≥–µ–Ω",
    "–î–æ—Ä—Ç–º—É–Ω–¥", "–î—Ä–µ–∑–¥–µ–Ω", "–î—é—Å—Å–µ–ª—å–¥–æ—Ä—Ñ", "–ó–∞—Ä–±—Ä—é–∫–µ–Ω", "–ó–∏–≥–µ–Ω",
    "–ö–∞—Å—Å–µ–ª—å", "–ö—ë–ª—å–Ω", "–ö–∏–ª—å", "–ö–æ–±–ª–µ–Ω—Ü", "–ö—Ä–µ—Ñ–µ–ª—å–¥",
    "–õ—é–±–µ–∫", "–ú–∞–π–Ω—Ü", "–ú–∞–Ω–≥–µ–π–º", "–ú—é–Ω—Å—Ç–µ—Ä", "–ú—é–Ω—Ö–µ–Ω",
    "–ù—é—Ä–Ω–±–µ—Ä–≥", "–û–ª—å–¥–µ–Ω–±—É—Ä–≥", "–ü–æ—Ç—Å–¥–∞–º", "–†–µ–≥–µ–Ω—Å–±—É—Ä–≥", "–†–æ—Å—Ç–æ–∫",
    "–®—Ç—É—Ç–≥–∞—Ä—Ç", "–§—Ä–∞–π–±—É—Ä–≥", "–§—Ä–∞–Ω–∫—Ñ—É—Ä—Ç-–Ω–∞-–ú–∞–π–Ω–µ", "–•–∞–≥–µ–Ω", "–•–∞–π–ª—å–±—Ä–æ–Ω–Ω",
    "–•–∞–º–º", "–•–µ–º–Ω–∏—Ü", "–¶–≤–∏–∫–∫–∞—É", "–≠—Ä—Ñ—É—Ä—Ç", "–≠—Å—Å–µ–Ω",
    "–ê—Ö–µ–Ω", "–•–∞–Ω–∞—É", "–•–µ—Ä–Ω–µ", "–ó–æ–ª–∏–Ω–≥–µ–Ω", "–£–ª—å–º"
  ],
    "–ì—Ä—É–∑–∏—è": [
      "–ê—Ö–∞–ª—Ü–∏—Ö–µ", "–ê—Ö–∞–ª–∫–∞–ª–∞–∫–∏", "–ë–∞—Ç—É–º–∏", "–ë–æ–ª–Ω–∏—Å–∏", "–í–∞–ª–µ",
      "–ì–∞—Ä–¥–∞–±–∞–Ω–∏", "–ì–æ—Ä–∏", "–ì—É—Ä–¥–∂–∞–∞–Ω–∏", "–î–µ–¥–æ–ø–ª–∏—Å—Ü–∫–∞—Ä–æ", "–î–º–∞–Ω–∏—Å–∏",
      "–î—É—à–µ—Ç–∏", "–ó–µ—Å—Ç–∞—Ñ–æ–Ω–∏", "–ó—É–≥–¥–∏–¥–∏", "–ö–∞—Å–ø–∏", "–ö–≤–∞—Ä–µ–ª–∏",
      "–ö–æ–±—É–ª–µ—Ç–∏", "–õ–∞–≥–æ–¥–µ—Ö–∏", "–õ–∞–Ω—á—Ö—É—Ç–∏", "–ú–∞—Ä–Ω–µ—É–ª–∏", "–ú–∞—Ä—Ç–≤–∏–ª–∏",
      "–û–∑—É—Ä–≥–µ—Ç–∏", "–û–Ω", "–ü–æ—Ç–∏", "–†—É—Å—Ç–∞–≤–∏", "–°–∞–≥–∞—Ä–µ–¥–∂–æ",
      "–°–∞–º—Ç—Ä–µ–¥–∏–∞", "–°–µ–Ω–∞–∫–µ", "–°–∏–≥–Ω–∞—Ö–∏", "–¢–µ–ª–∞–≤–∏", "–¢–µ—Ç—Ä–∏-–¶–∫–∞—Ä–æ",
      "–¢–∫–∏–±—É–ª–∏", "–¢–±–∏–ª–∏—Å–∏", "–¢–∫–∏–±—É–ª–∏", "–¶–∞–ª–µ–Ω–¥–∂–∏—Ö–∞", "–¶–∞–ª–∫–∏",
      "–¶–Ω–æ—Ä–∏", "–¶—Ö–∞–ª—Ç—É–±–æ", "–¶—Ö–∏–Ω–≤–∞–ª–∏", "–ß–∞–∫–≤–∏", "–ß–∏–∞—Ç—É—Ä–∞",
      "–ß–æ—Ö–∞—Ç–∞—É—Ä–∏", "–®–∞—É–º—è–Ω–∏", "–®–µ–º–æ–∫–º–µ–¥–∏", "–®–æ—Ä–æ–ø–∞–Ω–∏", "–•–∞—à—É—Ä–∏",
      "–•–æ–±–∏", "–•–æ–Ω–∏", "–•—É–ª–æ", "–¶–∏—Ç–µ–ª—Ü–∫–∞—Ä–æ", "–ö—É—Ç–∞–∏—Å–∏"
    ],
    "–ò–∑—Ä–∞–∏–ª—å": [
      "–ê–∫–∫–æ", "–ê—Ä–∞–¥", "–ê—à–¥–æ–¥", "–ê—à–∫–µ–ª–æ–Ω", "–ë–∞—Ç-–Ø–º",
      "–ë–µ—ç—Ä-–®–µ–≤–∞", "–ë–Ω–µ–π-–ë—Ä–∞–∫", "–ì–µ—Ä—Ü–ª–∏—è", "–ì–∏–≤–∞—Ç–∞–∏–º", "–ì—É—à-–î–∞–Ω",
      "–î–∏–º–æ–Ω–∞", "–ô–µ—Ä—É—Ö–∞–º", "–ö–∞—Ä–º–∏—ç–ª—å", "–ö–∏—Ä—å—è—Ç-–®–º–æ–Ω–∞", "–ö–∏—Ä—å—è—Ç-–ê—Ç–∞",
      "–ö–∏—Ä—å—è—Ç-–ë—è–ª–∏–∫", "–ö–∏—Ä—å—è—Ç-–ú–∞–ª–∞—Ö–∏", "–ö–∏—Ä—å—è—Ç-–ú–æ—Ü–∫–∏–Ω", "–ö–∏—Ä—å—è—Ç-–Ø–º", "–õ–æ–¥",
      "–ú–∞–∞–ª–µ-–ê–¥—É–º–∏–º", "–ú–∏–≥–¥–∞–ª—å", "–ú–æ–¥–∏–Ω", "–ù–∞–≥–∞—Ä–∏—è", "–ù–∞–∑—Ä–µ—Ç",
      "–ù–∞—Ö–∞–ª–∞–ª—å", "–ù–µ—à–µ—Ä", "–ù–µ—Ç–∞–Ω–∏—è", "–ù–µ—Ç–∏–≤–æ—Ç", "–û—Ñ–∞–∫–∏–º",
      "–ü–∞—Ä–¥–µ—Å-–•–∞–Ω–∞", "–ü–µ—Ç–∞—Ö-–¢–∏–∫–≤–∞", "–†–∞–º–∞—Ç-–ì–∞–Ω", "–†–∞–º–∞—Ç-–•–∞-–®–∞—Ä–æ–Ω", "–†–µ—Ö–æ–≤–æ—Ç",
      "–†–æ—à-—Ö–∞-–ê–∏–Ω", "–°–¥–µ—Ä–æ—Ç", "–¢–µ–ª—å-–ê–≤–∏–≤", "–¢–≤–µ—Ä–∏—è", "–£–º-—ç–ª—å-–§–∞—Ö–º",
      "–•–∞–π—Ñ–∞", "–•–∞–¥–µ—Ä–∞", "–•–æ–ª–æ–Ω", "–®–æ—Ö–∞–º", "–Ø–≤–Ω–µ",
      "–Ø—Ñ—Ñ–æ", "–ö–∞—Ü—Ä–∏–Ω", "–ô–æ–∫–Ω–µ–∞–º", "–ë–µ–π—Ç-–®–µ–º–µ—à", "–ë–µ–π—Ç-–Ø–Ω"
    ],
    // ‚Ä¶ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
  };

window.addEventListener("DOMContentLoaded", () => {
  const countrySelect = document.getElementById("country");
  const citySelect = document.getElementById("city");
  const adForm = document.getElementById("adForm");
  const contactInput = document.getElementById("contact");
  const textInput = document.getElementById("text");
  const categorySelect = document.getElementById("category");
  const gdprCheckbox = document.getElementById("gdpr");
  const viewBtn = document.getElementById("viewBtn");
  const addBtn = document.getElementById("addBtn");
  const backBtn = document.getElementById("backBtn");

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
  if (!window.Telegram || !Telegram.WebApp || !Telegram.WebApp.initDataUnsafe) {
    alert("‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ.");
    return;
  }

  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω
  const countryList = Object.keys(countries).sort();
  countryList.forEach((country) => {
    const option = document.createElement("option");
    option.value = country;
    option.textContent = country;
    countrySelect.appendChild(option);
  });

  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å—Ç—Ä–∞–Ω—ã
  countrySelect.addEventListener("change", () => {
    const cities = countries[countrySelect.value] || [];
    citySelect.innerHTML = "";
    cities.sort().forEach((city) => {
      const option = document.createElement("option");
      option.value = city;
      option.textContent = city;
      citySelect.appendChild(option);
    });
  });

  // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  countrySelect.dispatchEvent(new Event("change"));

  // –ö–Ω–æ–ø–∫–∞ "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è"
  viewBtn.addEventListener("click", () => {
    const payload = {
      action: "view",
      country: countrySelect.value,
      city: citySelect.value
    };

    try {
      Telegram.WebApp.sendData(JSON.stringify(payload));
      console.log("üì§ Payload sent (view):", payload);

      // –ü–µ—Ä–µ—Ö–æ–¥ –≤ –≥—Ä—É–ø–ø—É
      if (payload.country === "–ì–µ—Ä–º–∞–Ω–∏—è" && payload.city === "–ì–µ–ª—å–¥–µ—Ä–Ω") {
        Telegram.WebApp.openTelegramLink("https://t.me/zhivuv_gelderne");
      }
    } catch (err) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –≥—Ä—É–ø–ø—É:", err);
      alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≥—Ä—É–ø–ø—ã.");
    }
  });

  // –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ"
  addBtn.addEventListener("click", () => {
    adForm.style.display = "block";
    viewBtn.style.display = "none";
    addBtn.style.display = "none";
    backBtn.style.display = "block";
  });

  // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
  backBtn.addEventListener("click", () => {
    adForm.style.display = "none";
    viewBtn.style.display = "block";
    addBtn.style.display = "block";
    backBtn.style.display = "none";
  });

  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
  adForm.addEventListener("submit", (e) => {
    e.preventDefault();

    if (!gdprCheckbox.checked) {
      alert("‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.");
      return;
    }

    const payload = {
      action: "add",
      country: countrySelect.value,
      city: citySelect.value,
      category: categorySelect.value,
      contact: contactInput.value.trim(),
      text: textInput.value.trim()
    };

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç—ã–µ –ø–æ–ª—è
    if (!payload.category || !payload.contact || !payload.text) {
      alert("‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.");
      return;
    }

    try {
      Telegram.WebApp.sendData(JSON.stringify(payload));
      console.log("üì§ Payload sent (add):", payload);
    } catch (err) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", err);
      alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.");
    }
  });
});
