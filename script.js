const countries = {
  "Азербайджан": [
    "Агдам", "Агдаш", "Агджабеди", "Агстафа", "Астара",
    "Баку", "Барда", "Бейлаган", "Балакен", "Гянджа",
    "Гобустан", "Губа", "Горадаг", "Гёйчай", "Гянджа",
    "Закаталы", "Загатала", "Зардоб", "Имирли", "Имишли",
    "Кельбаджар", "Кусары", "Кюрдамир", "Ленкорань", "Мингечаур",
    "Нафталан", "Нахичевань", "Нефтечала", "Огуз", "Саатлы",
    "Сабирабад", "Сальян", "Самух", "Сумгаит", "Тертер",
    "Товуз", "Уджары", "Физули", "Хачмаз", "Ходжавенд",
    "Худат", "Хызы", "Шамкир", "Шарур", "Шеки",
    "Шемаха", "Ширван", "Шуша", "Ярдымлы", "Исмаиллы"
  ],
  "Армения": [
    "Абовян", "Айрум", "Алагёз", "Алаверди", "Ани",
    "Арагац", "Арарат", "Артик", "Армавир", "Артаваз",
    "Арцни", "Аштарак", "Бюрегаван", "Берд", "Вагаршапат",
    "Ванадзор", "Веди", "Гавар", "Гарни", "Геховит",
    "Гехаркуник", "Горис", "Гюмри", "Джермук", "Дилижан",
    "Егвард", "Ерасх", "Ереван", "Ехегнадзор", "Зовун",
    "Иджеван", "Капан", "Маралик", "Масис", "Мартуни",
    "Мецамор", "Ноемберян", "Нор Ачин", "Нор Хачн", "Раздан",
    "Севан", "Сисиан", "Спитак", "Степанаван", "Талин",
    "Ташир", "Чаренцаван", "Цахкадзор", "Шнох", "Ширак"
  ],
  "Германия": [
    "Аугсбург", "Берлин", "Билефельд", "Бонн", "Бохум",
    "Брауншвейг", "Бремен", "Висбаден", "Вольфсбург", "Вупперталь",
    "Ганновер", "Гельзенкирхен", "Гельдерн", "Гера", "Гёттинген",
    "Дортмунд", "Дрезден", "Дюссельдорф", "Зарбрюкен", "Зиген",
    "Кассель", "Кёльн", "Киль", "Кобленц", "Крефельд",
    "Любек", "Майнц", "Мангейм", "Мюнстер", "Мюнхен",
    "Нюрнберг", "Ольденбург", "Потсдам", "Регенсбург", "Росток",
    "Штутгарт", "Фрайбург", "Франкфурт-на-Майне", "Хаген", "Хайльбронн",
    "Хамм", "Хемниц", "Цвиккау", "Эрфурт", "Эссен",
    "Ахен", "Ханау", "Херне", "Золинген", "Ульм"
  ],
    "Грузия": [
      "Ахалцихе", "Ахалкалаки", "Батуми", "Болниси", "Вале",
      "Гардабани", "Гори", "Гурджаани", "Дедоплисцкаро", "Дманиси",
      "Душети", "Зестафони", "Зугдиди", "Каспи", "Кварели",
      "Кобулети", "Лагодехи", "Ланчхути", "Марнеули", "Мартвили",
      "Озургети", "Он", "Поти", "Рустави", "Сагареджо",
      "Самтредиа", "Сенаке", "Сигнахи", "Телави", "Тетри-Цкаро",
      "Ткибули", "Тбилиси", "Ткибули", "Цаленджиха", "Цалки",
      "Цнори", "Цхалтубо", "Цхинвали", "Чакви", "Чиатура",
      "Чохатаури", "Шаумяни", "Шемокмеди", "Шоропани", "Хашури",
      "Хоби", "Хони", "Хуло", "Цителцкаро", "Кутаиси"
    ],
    "Израиль": [
      "Акко", "Арад", "Ашдод", "Ашкелон", "Бат-Ям",
      "Беэр-Шева", "Бней-Брак", "Герцлия", "Гиватаим", "Гуш-Дан",
      "Димона", "Йерухам", "Кармиэль", "Кирьят-Шмона", "Кирьят-Ата",
      "Кирьят-Бялик", "Кирьят-Малахи", "Кирьят-Моцкин", "Кирьят-Ям", "Лод",
      "Маале-Адумим", "Мигдаль", "Модин", "Нагария", "Назрет",
      "Нахалаль", "Нешер", "Нетания", "Нетивот", "Офаким",
      "Пардес-Хана", "Петах-Тиква", "Рамат-Ган", "Рамат-Ха-Шарон", "Реховот",
      "Рош-ха-Аин", "Сдерот", "Тель-Авив", "Тверия", "Ум-эль-Фахм",
      "Хайфа", "Хадера", "Холон", "Шохам", "Явне",
      "Яффо", "Кацрин", "Йокнеам", "Бейт-Шемеш", "Бейт-Ян"
    ],
    // … остальные страны по аналогии
  };

window.addEventListener("DOMContentLoaded", () => {
  const countrySelect = document.getElementById("country");
  const citySelect = document.getElementById("city");
  const addForm = document.getElementById("adForm");

  // Заполняем список стран
  const countryList = Object.keys(countries).sort();
  for (const country of countryList) {
    const option = document.createElement("option");
    option.value = country;
    option.textContent = country;
    countrySelect.appendChild(option);
  }

  // Обновляем список городов при смене страны
  countrySelect.addEventListener("change", () => {
    const selectedCountry = countrySelect.value;
    const cityList = countries[selectedCountry] || [];
    citySelect.innerHTML = "";
    cityList.sort().forEach(city => {
      const option = document.createElement("option");
      option.value = city;
      option.textContent = city;
      citySelect.appendChild(option);
    });
  });

  // Инициализация значений по умолчанию
  countrySelect.dispatchEvent(new Event("change"));

  // "Посмотреть объявления"
  document.getElementById("viewBtn").addEventListener("click", () => {
    const country = countrySelect.value;
    const city = citySelect.value;
    const payload = { action: "view", country, city };
    Telegram.WebApp.sendData(JSON.stringify(payload));
  });

  // "Добавить объявление" — показать форму
  document.getElementById("addBtn").addEventListener("click", () => {
    addForm.style.display = "block";
  });

  // Отправка формы
  addForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const country = countrySelect.value;
    const city = citySelect.value;
    const category = document.getElementById("category").value;
    const contact = document.getElementById("contact").value.trim();
    const text = document.getElementById("text").value.trim();
    const gdpr = document.getElementById("gdpr").checked;

    if (!gdpr) {
      alert("Вы должны согласиться с обработкой персональных данных.");
      return;
    }

    const payload = {
      action: "add",
      country,
      city,
      category,
      contact,
      text
      // Фото пока не отправляется
    };

    Telegram.WebApp.sendData(JSON.stringify(payload));
  });
});
